<div class="dashboard-container">
  <div class="container-fluid px-4">
    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="!loading && error" class="alert alert-danger mt-4 shadow-sm">
      <div class="d-flex align-items-center">
        <i class="bi bi-exclamation-triangle-fill me-2 fs-5"></i>
        <div class="flex-grow-1">
          <strong>Error:</strong> {{ error }}
        </div>
      </div>
      <div class="mt-3">
        <button class="btn btn-sm btn-outline-danger me-2" (click)="loadData()">
          <i class="bi bi-arrow-clockwise me-1"></i> Retry
        </button>
        <button *ngIf="error && error.includes('Unauthorized')" class="btn btn-sm btn-primary" (click)="router.navigate(['/login'])">
          <i class="bi bi-box-arrow-in-right me-1"></i> Go to Login
        </button>
      </div>
    </div>

    <!-- No Data -->
    <div *ngIf="!loading && !error && !data" class="alert alert-warning mt-4 shadow-sm">
      <div class="d-flex align-items-center">
        <i class="bi bi-info-circle-fill me-2 fs-5"></i>
        <div class="flex-grow-1">
          <strong>No Data:</strong> Dashboard data is not available.
        </div>
      </div>
      <button class="btn btn-sm btn-outline-warning mt-2" (click)="loadData()">
        <i class="bi bi-arrow-clockwise me-1"></i> Refresh
      </button>
    </div>

    <!-- Dashboard -->
    <ng-container *ngIf="!loading && !error && data">
      <div class="dashboard-header">
        <h2 class="mb-0">
          <i class="bi bi-speedometer2 me-2"></i>Dashboard
        </h2>
        <p class="text-muted mb-0 mt-2">Welcome back! Here's your overview</p>
      </div>

      <!-- Stat Cards Section -->
      <div class="row g-4 mb-4">
        <div class="col-lg-3 col-md-6">
          <div class="card stat-card total-tasks h-100">
            <div class="card-body text-center position-relative">
              <i class="bi bi-list-task card-icon text-primary"></i>
              <h5 class="card-title">Total Tasks</h5>
              <p class="card-text text-primary">{{ data.totalTasks || 0 }}</p>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6">
          <div class="card stat-card completed-tasks h-100">
            <div class="card-body text-center position-relative">
              <i class="bi bi-check-circle card-icon text-success"></i>
              <h5 class="card-title">Completed Tasks</h5>
              <p class="card-text text-success">{{ data.completedTasks || 0 }}</p>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6">
          <div class="card stat-card in-progress-tasks h-100">
            <div class="card-body text-center position-relative">
              <i class="bi bi-arrow-repeat card-icon text-info"></i>
              <h5 class="card-title">In Progress Tasks</h5>
              <p class="card-text text-info">{{ data.underProcessTasks || 0 }}</p>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6">
          <div class="card stat-card on-hold-tasks h-100">
            <div class="card-body text-center position-relative">
              <i class="bi bi-pause-circle card-icon text-warning"></i>
              <h5 class="card-title">On Hold Tasks</h5>
              <p class="card-text text-warning">{{ data.onHoldTasks || 0 }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="row g-4 mb-4">
        <div class="col-lg-4 col-md-6">
          <div class="card chart-card h-100">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="bi bi-pie-chart me-2"></i>Project Distribution
              </h5>
            </div>
            <div class="card-body">
              <div class="chart-container" style="height: 300px; position: relative;">
                <canvas #projectDistributionCanvas *ngIf="data && data.projectCounts && data.projectCounts.length > 0"></canvas>
                <div *ngIf="!data || !data.projectCounts || data.projectCounts.length === 0" class="no-data-message text-center py-5">
                  <i class="bi bi-inbox me-2"></i>No data available
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-4 col-md-6">
          <div class="card chart-card h-100">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="bi bi-bar-chart me-2"></i>Task Status Overview
              </h5>
            </div>
            <div class="card-body">
              <div class="chart-container" style="height: 300px; position: relative;">
                <canvas #taskStatusCanvas *ngIf="data"></canvas>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-4 col-md-6">
          <div class="card chart-card h-100">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="bi bi-graph-up me-2"></i>Daily Activity
              </h5>
            </div>
            <div class="card-body">
              <div class="chart-container" style="height: 300px; position: relative;">
                <canvas #dailyActivityCanvas *ngIf="data && data.taskCountsByDate && data.taskCountsByDate.length > 0"></canvas>
                <div *ngIf="!data || !data.taskCountsByDate || data.taskCountsByDate.length === 0" class="no-data-message text-center py-5">
                  <i class="bi bi-inbox me-2"></i>No data available
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>


    </ng-container>
  </div>
</div>
