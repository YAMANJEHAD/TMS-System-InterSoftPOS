<div class="paper-requests-container">
  <app-breadcrumb [items]="[{ label: 'Paper Requests' }]"></app-breadcrumb>
  
  <div class="page-header">
    <h1>Paper Requests</h1>
    <button class="primary-button" (click)="openAddModal()">
      <span class="material-icons">add</span>
      <span>Create New Paper Case</span>
    </button>
  </div>

  <!-- Filters -->
  <div class="filters-card card">
    <div class="filters-header">
      <span class="material-icons">filter_list</span>
    <h2>Filters</h2>
    </div>
    <div class="filters-grid">
      <div class="form-group">
        <label>
          <span class="material-icons">event</span>
          From Date
        </label>
        <input type="date" [(ngModel)]="fromDate" />
      </div>
      <div class="form-group">
        <label>
          <span class="material-icons">event</span>
          To Date
        </label>
        <input type="date" [(ngModel)]="toDate" />
      </div>
      <div class="form-group">
        <label>
          <span class="material-icons">person</span>
          Entry User
        </label>
        <select [(ngModel)]="entryUser">
          <option [value]="-1">All Users</option>
          <option *ngFor="let user of users" [value]="user.userId">
            {{ user.name }}
          </option>
        </select>
      </div>
    </div>
    <div class="filter-actions">
      <button class="primary-button" (click)="applyFilters()">
        <span class="material-icons">check</span>
        <span>Apply Filters</span>
      </button>
      <button class="secondary-button" (click)="resetFilters()">
        <span class="material-icons">refresh</span>
        <span>Reset</span>
      </button>
    </div>
  </div>

  <!-- Papers Table -->
  <div class="table-container card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 12px;">
      <h2>Paper Cases</h2>
      <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
        <button class="excel-export-button" (click)="exportToExcel()">
          <span class="material-icons">table_chart</span>
          <span>Export Excel</span>
        </button>
        <label>Items per page:</label>
        <select [(ngModel)]="pageSize" (change)="onPageSizeChange()" style="padding: 5px 10px; border-radius: 4px;">
          <option [value]="10">10</option>
          <option [value]="25">25</option>
          <option [value]="50">50</option>
          <option [value]="100">100</option>
        </select>
      </div>
    </div>
    <div class="loading" *ngIf="isLoading">Loading papers...</div>
    
    <table *ngIf="!isLoading">
      <thead>
        <tr>
          <th>Cancelled Terminal No</th>
          <th>Delivered Terminal No</th>
          <th>Cancelled Ticket No</th>
          <th>Delivered Ticket No</th>
          <th>Entry User</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let paper of papers">
          <td>{{ paper.cancelledTerminalNo }}</td>
          <td>{{ paper.deliveredTerminalNo }}</td>
          <td>{{ paper.cancelledTicketNo }}</td>
          <td>{{ paper.deliveredTicketNo }}</td>
          <td>
            <div class="user-cell">
              <div class="user-avatar" [style.background-color]="getUserAvatarColor(paper.entryUser)">
                {{ getUserInitials(paper.entryUser) }}
              </div>
              <span class="user-name">{{ paper.entryUser }}</span>
            </div>
          </td>
          <td>
            <div class="action-buttons">
              <button class="action-btn" (click)="openEditModal(paper)" title="Update">
                <span class="material-icons">edit</span>
              </button>
              <button class="btn-delete" (click)="openDeleteModal(paper.id)" title="Delete">
                <span class="material-icons">delete</span>
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="papers.length === 0">
          <td colspan="6" class="no-data">No papers found</td>
        </tr>
      </tbody>
    </table>
    
    <!-- Pagination -->
    <div class="pagination" *ngIf="papers.length > 0">
      <button class="btn-pagination" (click)="onPageChange(currentPage - 1)" [disabled]="currentPage === 1">Previous</button>
      <span>Page {{ currentPage }}<span *ngIf="totalPages > currentPage"> of {{ totalPages }}</span></span>
      <button class="btn-pagination" (click)="onPageChange(currentPage + 1)" [disabled]="papers.length < pageSize">Next</button>
      <span class="pagination-info" *ngIf="totalItems > 0">(Showing {{ (currentPage - 1) * pageSize + 1 }}-{{ (currentPage - 1) * pageSize + papers.length }} of ~{{ totalItems }}+)</span>
    </div>
  </div>

  <!-- Add Paper Modal -->
  <div class="modal" *ngIf="showAddModal" (click)="closeAddModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Create New Paper Case</h2>
        <button class="close-btn" (click)="closeAddModal()">×</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Cancelled Terminal No *</label>
          <input type="text" [(ngModel)]="formData.cancelledTerminalNo" />
        </div>
        <div class="form-group">
          <label>Delivered Terminal No *</label>
          <input type="text" [(ngModel)]="formData.deliveredTerminalNo" />
        </div>
        <div class="form-group">
          <label>Cancelled Ticket No *</label>
          <input type="text" [(ngModel)]="formData.cancelledTicketNo" />
        </div>
        <div class="form-group">
          <label>Delivered Ticket No *</label>
          <input type="text" [(ngModel)]="formData.deliveredTicketNo" />
        </div>
      </div>
      <div class="modal-footer">
        <button class="secondary-button" (click)="closeAddModal()">Cancel</button>
        <button class="primary-button" (click)="createPaper()">Create</button>
      </div>
    </div>
  </div>

  <!-- Edit Paper Modal -->
  <div class="modal" *ngIf="showEditModal" (click)="closeEditModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Update Paper Case</h2>
        <button class="close-btn" (click)="closeEditModal()">×</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Cancelled Terminal No *</label>
          <input type="text" [(ngModel)]="editFormData.cancelledTerminalNo" />
        </div>
        <div class="form-group">
          <label>Delivered Terminal No *</label>
          <input type="text" [(ngModel)]="editFormData.deliveredTerminalNo" />
        </div>
        <div class="form-group">
          <label>Cancelled Ticket No *</label>
          <input type="text" [(ngModel)]="editFormData.cancelledTicketNo" />
        </div>
        <div class="form-group">
          <label>Delivered Ticket No *</label>
          <input type="text" [(ngModel)]="editFormData.deliveredTicketNo" />
        </div>
      </div>
      <div class="modal-footer">
        <button class="secondary-button" (click)="closeEditModal()">Cancel</button>
        <button class="primary-button" (click)="updatePaper()">Update</button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <app-confirmation-modal
    [show]="showDeleteModal"
    title="Delete Paper Request"
    message="Are you sure you want to delete this paper request? This action cannot be undone."
    confirmText="Delete"
    cancelText="Cancel"
    type="danger"
    (confirmed)="deletePaper()"
    (closed)="closeDeleteModal()"
    (cancelled)="closeDeleteModal()">
  </app-confirmation-modal>
</div>
