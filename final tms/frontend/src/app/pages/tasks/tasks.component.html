<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>All Tasks</h2>
  </div>

  <!-- Filters -->
  <div class="card mb-4">
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-3">
          <label class="form-label">Title</label>
          <input type="text" class="form-control" placeholder="Search by title..." 
                 [(ngModel)]="title" (input)="onSearchChange()">
        </div>
        <div class="col-md-3">
          <label class="form-label">From Date</label>
          <input type="date" class="form-control" [(ngModel)]="fromDate" (change)="onFilterChange()">
        </div>
        <div class="col-md-3">
          <label class="form-label">To Date</label>
          <input type="date" class="form-control" [(ngModel)]="toDate" (change)="onFilterChange()">
        </div>
        <div class="col-md-3">
          <label class="form-label">Status</label>
          <select class="form-select" [(ngModel)]="statusId" (change)="onFilterChange()" [disabled]="loadingFilters">
            <option [ngValue]="null">All Statuses</option>
            <option *ngFor="let status of statuses" [ngValue]="status.statusId">
              {{ status.statusName }}
            </option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Priority</label>
          <select class="form-select" [(ngModel)]="priorityId" (change)="onFilterChange()" [disabled]="loadingFilters">
            <option [ngValue]="null">All Priorities</option>
            <option *ngFor="let priority of priorities" [ngValue]="priority.priorityId">
              {{ priority.priorityName }}
            </option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Project</label>
          <select class="form-select" [(ngModel)]="projectId" (change)="onFilterChange()" [disabled]="loadingFilters">
            <option [ngValue]="null">All Projects</option>
            <option *ngFor="let project of projects" [ngValue]="project.projectId">
              {{ project.name }}
            </option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">User</label>
          <select class="form-select" [(ngModel)]="userId" (change)="onFilterChange()" [disabled]="loadingFilters">
            <option [ngValue]="null">All Users</option>
            <option *ngFor="let user of users" [ngValue]="user.userId">
              {{ user.name }}
            </option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">&nbsp;</label>
          <button class="btn btn-outline-secondary w-100" (click)="clearFilters()">
            <i class="bi bi-x-circle me-1"></i>Clear Filters
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="!loading && error" class="alert alert-danger">
    {{ error }}
    <button class="btn btn-sm btn-outline-danger ms-2" (click)="loadTasks()">Retry</button>
  </div>

  <!-- Tasks Table -->
  <div *ngIf="!loading && !error" class="card">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>Task ID</th>
              <th>Title</th>
              <th>Project</th>
              <th>Status</th>
              <th>Priority</th>
              <th>Due Date</th>
              <th>Assigned To</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let task of tasks">
              <td>{{ task.taskId }}</td>
              <td>{{ task.title }}</td>
              <td>{{ task.projectName }}</td>
              <td>
                <span class="badge" [ngClass]="{
                  'bg-success': task.statusName === 'Completed',
                  'bg-info': task.statusName === 'In Progress',
                  'bg-warning': task.statusName === 'On Hold',
                  'bg-secondary': task.statusName === 'Pending'
                }">
                  {{ task.statusName }}
                </span>
              </td>
              <td>
                <span class="badge" [ngClass]="{
                  'bg-danger': task.priorityName?.toLowerCase()?.includes('high'),
                  'bg-warning': task.priorityName?.toLowerCase()?.includes('medium'),
                  'bg-secondary': task.priorityName?.toLowerCase()?.includes('low')
                }">
                  {{ task.priorityName || 'N/A' }}
                </span>
              </td>
              <td>{{ task.dueDate | date:'shortDate' }}</td>
              <td>{{ task.entryUser }}</td>
            </tr>
            <tr *ngIf="tasks.length === 0 && !loading">
              <td colspan="7" class="text-center text-muted">No tasks found</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

